{% extends 'ocean_do/pages_base.html' %}
{% load static %}
{% block title %}
{{ task.title }}
{% endblock %}


{% block side-menu %}
<li><a href="{% url 'main' %}"><i class='bx bx-home-alt icon'></i> Головна</a></li>
<li><a href="#"><i class='bx bx-calendar icon'></i> Календар</a></li>
<li><a href="{% url 'tasks:all_tasks' %}" class="active"><i class='bx bx-task icon'></i>Завдання</a></li>
<li><a href="#"><i class='bx bx-folder icon'></i> Папки <i
        class='bx bx-chevron-right icon-right'></i></a>
    <ul class="side-dropdown">
        <li><a href="#">Папкаaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa 1</a></li>
        <li><a href="#">Папка 2</a></li>
        <li><a href="#">Папка 3</a></li>
        <li><a href="#">Папка 4</a></li>
        <li><a href="#">Папка 5</a></li>
        <li><a href="#">Папка 6</a></li>
        <li><a href="#">Папка 7</a></li>
    </ul>
</li>
{% endblock %}

{% block content_area %}

<main id="task-info" data-task-id="{{ task.id }}">
    <div class="task-path">
        <h1 class="title folder">Папка</h1>
        <h1 class="title divider">/</h1>
        <h1 class="title task-name">{{ task.title }}</h1>
    </div>

    <div class="task-divider">
        <div class="task-info-page-container">
            <div class="task-info-container">
                <div class="head">
                    <div class="category-block">
                        <p class="title">Категорія:</p>
                        <p class="block-value">Виконання</p>
                    </div>
                    <!--                    <i class='bx bx-dots-horizontal-rounded icon'></i>-->

                    <div class="user-status-block">
                        <p class="title">Статус виконання</p>
                        {% for assignment in task.assignees.all %}
                        {% if assignment.user == request.user %}
                        <p class="user-task-status">
                            {% if assignment.is_completed %}
                            Виконано
                            {% else %}
                            У процесі виконання
                            {% endif %}
                        </p>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% if task.tags.all %}
                <div class="info-block">

                    <p class="title">Теги:</p>
                    <div class="tags-values">
                        {% for tag in task.tags.all %}
                        <p class="tag">{{ tag.name }}</p>
                        {% endfor %}
                    </div>

                </div>
                {% endif %}
                {% if task.description %}
                <div class="info-block vertical-block">
                    <p class="title">Опис:</p>
                    <p class="description">{{ task.description }}</p>
                </div>
                {% endif %}
                {% if task.files.all %}
                <div class="info-block vertical-block">
                    <p class="title">Файли:</p>
                    <ul class="file-list">
                        {% for file in task.files.all %}
                        <div class="file-div">
                            <li class="file-li">{{ file.title }}</li>
                            <a href="{{ file.file.url }}"
                               onclick="window.open(this.href, '_blank'); return false;">Завантажити</a>
                            </li>
                        </div>
                        {% endfor %}

                    </ul>

                </div>
                {% endif %}
                <div class="info-block time-block">
                    <p class="title">Термін виконання</p>
                    <p class="time-value">{{ task.deadline }}</p>
                </div>
            </div>
            <div class="task-info-comment-section">
                <div class="leave-comment">
                    <p class="title">Залишити коментар</p>
                    <form hx-ext="ws" ws-connect="/ws/comments/public-chat/" ws-send _="on htmx:wsAfterSend reset() me">
                        {% csrf_token %}
                        {{ form.message }}
                        <button type="submit" class="make-task">Надіслати</button>
                    </form>
                </div>

                <div class="comment-section">
                    <p class="title">Приватні коментарі:</p>
                    <ul id="comments">
                        {% for comment in comments reversed %}
                        <div class="comment">
                            {% if comment.user.photo %}
                            <img class="profile-picture" src="{{ comment.user.photo.url }}" alt="Avatar">
                            {% else %}
                            <img class="profile-picture" src="{% static 'img/profile-picture.jpg' %}" alt="No image">
                            {% endif %}
                            <div class="comment-text-block">
                                <div class="head">
                                    <p class="user-name">{{ comment.user.username }}</p>
                                    <p class="sent-date">{{ comment.created|date:"d.m.Y H:i" }}</p>
                                </div>
                                <p class="comment-text">{{ comment.message }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </ul>
                </div>
            </div>


        </div>

        <div>
            <div class="task-done-container">
                <form action="" method="post" enctype="multipart/form-data" class="task-done-form">
                    {% csrf_token %}
                    <div class="form-element">
                        <div class="tag-block">
                            <p class="title">Прикріпити файл</p>
                            <div class="add" id="add-file-input">
                                <i class='bx bx-plus-circle icon'></i>
                            </div>
                        </div>
                        <div id="file-inputs">


                            <!--                <label for="file-upload" class="custom-file-upload">Завантажити</label>-->
                            <!--                <input id="file-upload" type="file" name="files" onchange="displayFileName()" style="display: none;"/>-->
                            <!--                <span id="file-name"></span>-->
                        </div>
                    </div>
                    <button class="complete-task">Відправити</button>
                </form>
            </div>


            <div class="task-done-container">
                {% for file in task_assignment.files.all %}
                <div class="file-div">
                    <li class="file-li">{{ file.title }}</li>
                    <a href="{{ file.file.url }}"
                       onclick="window.open(this.href, '_blank'); return false;">Завантажити</a>
                    <button class="delete-file-btn" data-file-id="{{ file.id }}">Видалити</button>
                </div>
                {% endfor %}
            </div>


            <div class="task-done-container">
                <!--                <button class="complete-task" id="update-status-btn">Позначити як виконане</button>-->

                {% for assignment in task.assignees.all %}
                {% if assignment.user == request.user %}
                <button class="complete-task{% if assignment.is_completed %} completed{% endif %}"
                        id="update-status-btn">
                    {% if assignment.is_completed %}
                    Позначити як невиконане
                    {% else %}
                    Позначити як виконане
                    {% endif %}
                </button>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</main>
<!-- MAIN -->
{% endblock %}
